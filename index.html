<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wipecraft RPG 7.1</title>
    <script src="https://telegram.org"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --tg-bg: var(--tg-theme-bg-color, #1a1a1a); --tg-card: var(--tg-theme-secondary-bg-color, #2c2c2c); }
        body { background-color: var(--tg-bg); color: var(--tg-theme-text-color, #ffffff); overflow: hidden; height: 100vh; font-family: sans-serif; }
        .card { background: var(--tg-card); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .bar-bg { background: rgba(0,0,0,0.4); border-radius: 20px; height: 12px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s ease; width: 0%; }
        .hp-fill { background: linear-gradient(90deg, #ff4d4d, #f87171); }
        .en-fill { background: linear-gradient(90deg, #fbbf24, #fffbeb); }
        .btn-press:active { transform: scale(0.95); opacity: 0.8; }
    </style>
</head>
<body class="p-4 flex flex-col select-none">

    <div id="status" class="text-[8px] uppercase text-center mb-2 text-green-500 opacity-50 font-bold italic tracking-widest">‚óè Neural Link Active</div>

    <div class="card p-5 mb-4">
        <div class="flex justify-between items-end mb-4">
            <div class="w-2/3">
                <div class="text-[10px] uppercase opacity-50 font-black mb-1 italic text-blue-400">Player Profile</div>
                <h1 id="user-name" class="font-black text-xl truncate leading-none italic text-white">Syncing...</h1>
            </div>
            <div class="text-right">
                <span id="user-lvl" class="bg-blue-600 text-white px-2 py-0.5 rounded-full text-[10px] font-black italic">LVL 1</span>
            </div>
        </div>
        
        <div class="space-y-4">
            <div>
                <div class="flex justify-between text-[9px] font-bold mb-1.5 px-1 uppercase opacity-80">
                    <span>‚ù§Ô∏è Vitality</span><span id="hp-txt">0 / 0</span>
                </div>
                <div class="bar-bg"><div id="hp-bar" class="bar-fill hp-fill"></div></div>
            </div>
            <div>
                <div class="flex justify-between text-[9px] font-bold mb-1.5 px-1 uppercase opacity-80">
                    <span>‚ö° Energy</span><span id="en-txt">0 / 0</span>
                </div>
                <div class="bar-bg"><div id="en-bar" class="bar-fill en-fill"></div></div>
            </div>
        </div>
    </div>

    <div class="card p-4 mb-4 flex-grow overflow-hidden flex flex-col">
        <div class="flex justify-between items-center mb-3 text-[10px] uppercase font-black opacity-60 italic border-b border-white/5 pb-2">
            <span>üéí Cargo Bay</span><span id="weight-info">0.0/100.0 KG</span>
        </div>
        <div id="inventory-list" class="grid grid-cols-2 gap-2 overflow-y-auto content-start pr-1 text-[10px]">
            <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è —Ç—É—Ç -->
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
        <button onclick="handleAction('mine')" class="card p-4 btn-press flex flex-col items-center justify-center border-b-4 border-yellow-600/30">
            <span class="text-3xl mb-1">‚õè</span>
            <span class="text-[9px] font-black uppercase tracking-widest">Extract</span>
        </button>
        <button onclick="handleAction('hunt')" class="card p-4 btn-press flex flex-col items-center justify-center border-b-4 border-red-600/30">
            <span class="text-3xl mb-1">‚öîÔ∏è</span>
            <span class="text-[9px] font-black uppercase tracking-widest">Combat</span>
        </button>
    </div>

    <div id="log-container" class="h-20 font-mono text-[9px] p-2 bg-black/20 rounded-lg overflow-y-auto italic text-gray-500 border border-white/5 shadow-inner">
        <div id="log-content">> Uplink established...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        // –¢–í–û–ô –°–¢–ê–ë–ò–õ–¨–ù–´–ô –¢–£–ù–ù–ï–õ–¨
        const API_URL = "https://3d196cd21bcefc.lhr.life";

        tg.expand();
        tg.ready();

        async function apiCall(endpoint, data = {}) {
            try {
                const response = await fetch(`${API_URL}/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData: tg.initData, ...data })
                });
                return await response.json();
            } catch (err) {
                document.getElementById('status').innerText = "‚óã System Offline";
                document.getElementById('status').classList.replace("text-green-500", "text-red-500");
                return null;
            }
        }

        function updateBar(id, val, max) {
            const pct = Math.max(0, Math.min(100, (val / (max || 1)) * 100));
            document.getElementById(`${id}-bar`).style.width = `${pct}%`;
            document.getElementById(`${id}-txt`).innerText = `${val} / ${max}`;
        }

        async function sync() {
            const data = await apiCall('sync');
            if (data && data.success) {
                const user = data.user;
                document.getElementById('user-name').innerText = user.name;
                document.getElementById('user-lvl').innerText = `LVL ${user.level}`;
                updateBar('hp', user.hp, user.max_hp);
                updateBar('en', user.energy, user.max_energy);
                
                const list = document.getElementById('inventory-list');
                list.innerHTML = '';
                let weight = 0;
                if (user.inventory && user.inventory.length > 0) {
                    user.inventory.forEach(i => {
                        weight += (i.weight || 0.1) * i.quantity;
                        list.innerHTML += `<div class="bg-black/30 p-2 rounded-lg border border-white/5 flex justify-between"><span>${i.item_name}</span><span class="text-blue-400 font-bold">x${i.quantity}</span></div>`;
                    });
                } else {
                    list.innerHTML = '<div class="col-span-2 text-center py-4 opacity-20 italic">No cargo</div>';
                }
                document.getElementById('weight-info').innerText = `${weight.toFixed(1)}/100.0 KG`;
                document.getElementById('status').innerText = "‚óè Neural Link Active";
            }
        }

        async function handleAction(type) {
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            const res = await apiCall(type);
            if (res) {
                const log = document.getElementById('log-content');
                const msg = document.createElement('div');
                msg.className = res.success ? "text-blue-400" : "text-red-400";
                msg.innerText = `> ${res.msg}`;
                log.prepend(msg);
                if (res.success) sync();
            }
        }

        sync();
        setInterval(sync, 20000);
    </script>
</body>
</html>
