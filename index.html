<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wipecraft RPG 7.1</title>
    <script src="https://telegram.org"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --main-bg: var(--tg-theme-bg-color, #1a1a1a); --card-bg: var(--tg-theme-secondary-bg-color, #2c2c2c); }
        body { background-color: var(--main-bg); color: var(--tg-theme-text-color, #ffffff); overflow: hidden; height: 100vh; }
        .card { background: var(--card-bg); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); }
        .bar-bg { background: rgba(0,0,0,0.4); border-radius: 20px; height: 12px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s ease; width: 0%; }
        .hp-gradient { background: linear-gradient(90deg, #ff4d4d, #f87171); }
        .en-gradient { background: linear-gradient(90deg, #fbbf24, #fffbeb); }
    </style>
</head>
<body class="p-4 font-sans select-none flex flex-col">

    <div id="status-line" class="text-[8px] uppercase text-center mb-2 text-green-500 opacity-50 font-bold italic">‚óè System Linked</div>

    <div class="card p-5 mb-4 shadow-xl">
        <div class="flex justify-between items-end mb-4">
            <div class="w-2/3">
                <div class="text-[10px] uppercase opacity-50 font-black mb-1">Explorer</div>
                <h1 id="user-name" class="font-black text-xl text-blue-400 truncate">Connecting...</h1>
            </div>
            <div class="text-right"><span id="user-lvl" class="bg-blue-500 text-white px-2 py-0.5 rounded-full text-[10px] font-black">LVL 1</span></div>
        </div>
        <div class="space-y-4">
            <div>
                <div class="flex justify-between text-[9px] font-bold mb-1.5 px-1"><span>‚ù§Ô∏è VITALITY</span><span id="hp-txt">0 / 0</span></div>
                <div class="bar-bg"><div id="hp-fill" class="bar-fill hp-gradient"></div></div>
            </div>
            <div>
                <div class="flex justify-between text-[9px] font-bold mb-1.5 px-1"><span>‚ö° NEURAL ENERGY</span><span id="en-txt">0 / 0</span></div>
                <div class="bar-bg"><div id="en-fill" class="bar-fill en-gradient"></div></div>
            </div>
        </div>
    </div>

    <div class="card p-4 mb-4 flex-grow overflow-hidden flex flex-col">
        <div class="flex justify-between items-center mb-3 text-[10px] uppercase opacity-60 font-black">
            <span>üéí Cargo Bay</span>
            <span id="weight-info">0.0/100.0 KG</span>
        </div>
        <div id="inventory-list" class="grid grid-cols-2 gap-2 overflow-y-auto content-start"></div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
        <button onclick="handleAction('mine')" class="card p-4 flex flex-col items-center active:scale-95 transition-transform">
            <span class="text-3xl mb-1">‚õè</span><span class="text-[9px] font-black uppercase">Extract</span>
        </button>
        <button onclick="handleAction('hunt')" class="card p-4 flex flex-col items-center active:scale-95 transition-transform">
            <span class="text-3xl mb-1">‚öîÔ∏è</span><span class="text-[9px] font-black uppercase">Combat</span>
        </button>
    </div>

    <div class="h-20 font-mono text-[10px] p-2 bg-black/10 rounded-lg overflow-y-auto italic text-gray-500 border border-white/5">
        <div id="log-content">> Neural link established...</div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        // –¢–í–û–Ø –ê–ö–¢–£–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê
        const API_URL = "https://jones-borough-proceed-logos.trycloudflare.com";

        tg.expand();
        tg.ready();

        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_URL}/api/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData: tg.initData })
                });
                return await response.json();
            } catch (err) { return { success: false, msg: "Link error" }; }
        }

        async function refreshData() {
            const user = await apiCall('sync');
            if (user && user.id) {
                document.getElementById('user-name').innerText = user.name;
                document.getElementById('user-lvl').innerText = `LVL ${user.level}`;
                updateBar('hp', user.hp, user.max_hp);
                updateBar('en', user.energy, user.max_energy);
                loadInventory();
            }
        }

        function updateBar(id, val, max) {
            const pct = Math.max(0, Math.min(100, (val / max) * 100));
            document.getElementById(`${id}-fill`).style.width = `${pct}%`;
            document.getElementById(`${id}-txt`).innerText = `${val} / ${max}`;
        }

        async function loadInventory() {
            const items = await apiCall('inventory');
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            let weight = 0;
            items.forEach(i => {
                weight += (i.weight || 0.1) * i.quantity;
                list.innerHTML += `<div class="bg-black/30 p-2 rounded-xl border border-white/5 text-[9px] flex justify-between">
                    <span>${i.item_name}</span><span class="text-blue-400 font-black">x${i.quantity}</span>
                </div>`;
            });
            document.getElementById('weight-info').innerText = `${weight.toFixed(1)}/100.0 KG`;
        }

        async function handleAction(type) {
            tg.HapticFeedback.impactOccurred('medium');
            const res = await apiCall(type);
            const entry = document.createElement('div');
            entry.innerText = `> ${res.msg}`;
            document.getElementById('log-content').prepend(entry);
            refreshData();
        }

        refreshData();
        setInterval(refreshData, 15000);
    </script>
</body>
</html>
