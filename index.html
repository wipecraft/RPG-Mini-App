<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wipecraft RPG 7.1</title>
    <script src="https://telegram.org"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --tg-bg: var(--tg-theme-bg-color, #1a1a1a); --tg-card: var(--tg-theme-secondary-bg-color, #2c2c2c); }
        body { background-color: var(--tg-bg); color: var(--tg-theme-text-color, #ffffff); overflow: hidden; height: 100vh; font-family: sans-serif; transition: all 0.3s ease; }
        .card { background: var(--tg-card); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .bar-bg { background: rgba(0,0,0,0.4); border-radius: 20px; height: 12px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); width: 0%; }
        .hp-fill { background: linear-gradient(90deg, #ff4d4d, #f87171); box-shadow: 0 0 10px rgba(248,113,113,0.4); }
        .en-fill { background: linear-gradient(90deg, #fbbf24, #fffbeb); box-shadow: 0 0 10px rgba(251,191,36,0.4); }
        .btn-press:active { transform: scale(0.96); filter: brightness(1.2); }
        #log-container::-webkit-scrollbar { width: 0; }
    </style>
</head>
<body class="p-4 flex flex-col select-none">

    <div id="status" class="text-[8px] uppercase text-center mb-2 text-green-500 opacity-50 font-bold italic tracking-widest">‚óè System Linked</div>

    <div class="card p-5 mb-4">
        <div class="flex justify-between items-end mb-4">
            <div class="w-2/3">
                <div class="text-[10px] uppercase opacity-50 font-black mb-1 italic text-blue-400">Explorer Profile</div>
                <h1 id="user-name" class="font-black text-xl truncate leading-none italic text-white">Neural Sync...</h1>
            </div>
            <div class="text-right">
                <span id="user-lvl" class="bg-blue-600 text-white px-3 py-1 rounded-full text-[10px] font-black italic">LVL 1</span>
            </div>
        </div>
        
        <div class="space-y-4">
            <div>
                <div class="flex justify-between text-[9px] font-bold mb-1.5 px-1 uppercase opacity-80">
                    <span>‚ù§Ô∏è Vitality</span><span id="hp-txt">0 / 0</span>
                </div>
                <div class="bar-bg"><div id="hp-bar" class="bar-fill hp-fill"></div></div>
            </div>
            <div>
                <div class="flex justify-between text-[9px] font-bold mb-1.5 px-1 uppercase opacity-80">
                    <span>‚ö° Energy</span><span id="en-txt">0 / 0</span>
                </div>
                <div class="bar-bg"><div id="en-bar" class="bar-fill en-fill"></div></div>
            </div>
        </div>
    </div>

    <div class="card p-4 mb-4 flex-grow overflow-hidden flex flex-col">
        <div class="flex justify-between items-center mb-3 text-[10px] uppercase font-black opacity-60 italic border-b border-white/5 pb-2">
            <span>üéí Cargo Bay</span><span id="weight-info">0.0/100.0 KG</span>
        </div>
        <div id="inventory-list" class="grid grid-cols-2 gap-2 overflow-y-auto content-start pr-1 text-[10px]">
            <div class="col-span-2 text-center py-4 opacity-20 italic">Scanning...</div>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
        <button onclick="handleAction('mine')" class="card p-4 btn-press flex flex-col items-center justify-center border-b-4 border-yellow-600/30 bg-white/5">
            <span class="text-3xl mb-1">‚õè</span>
            <span class="text-[9px] font-black uppercase tracking-widest">Extract</span>
        </button>
        <button onclick="handleAction('hunt')" class="card p-4 btn-press flex flex-col items-center justify-center border-b-4 border-red-600/30 bg-white/5">
            <span class="text-3xl mb-1">‚öîÔ∏è</span>
            <span class="text-[9px] font-black uppercase tracking-widest">Combat</span>
        </button>
    </div>

    <div id="log-container" class="h-24 font-mono text-[9px] p-3 bg-black/40 rounded-lg overflow-y-auto italic text-gray-400 border border-white/5 shadow-inner">
        <div id="log-content">> System initialized. Waiting for uplink...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        // –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –∏–∑ —Ç–≤–æ–µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ª–æ–≥–∞
        const API_URL = "https://powerpoint-fantastic-emails-brands.trycloudflare.com";

        tg.expand();
        tg.ready();

        async function apiCall(endpoint, data = {}) {
            try {
                const response = await fetch(`${API_URL}/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        initData: tg.initData,
                        ...data 
                    })
                });
                const res = await response.json();
                
                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                if (response.status === 401 || response.status === 403) {
                    addLog("Access Denied: Neural link rejected", "red");
                    return null;
                }
                return res;
            } catch (err) {
                document.getElementById('status').innerText = "‚óã Link Offline";
                document.getElementById('status').classList.replace("text-green-500", "text-red-500");
                return null;
            }
        }

        function addLog(text, color = "gray") {
            const log = document.getElementById('log-content');
            const msg = document.createElement('div');
            const colors = { red: "text-red-400", blue: "text-blue-400", green: "text-green-400", gray: "text-gray-500" };
            msg.className = `mb-1 ${colors[color] || colors.gray}`;
            msg.innerText = `> ${text}`;
            log.prepend(msg);
        }

        function updateBar(id, val, max) {
            const pct = Math.max(0, Math.min(100, (val / max) * 100));
            document.getElementById(`${id}-bar`).style.width = `${pct}%`;
            document.getElementById(`${id}-txt`).innerText = `${val} / ${max}`;
        }

        async function sync() {
            const data = await apiCall('sync');
            if (data && data.success) {
                const user = data.user;
                document.getElementById('user-name').innerText = user.name;
                document.getElementById('user-lvl').innerText = `LVL ${user.level}`;
                updateBar('hp', user.hp, user.max_hp);
                updateBar('en', user.energy, user.max_energy);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                const list = document.getElementById('inventory-list');
                list.innerHTML = '';
                let weight = 0;
                if (user.inventory && user.inventory.length > 0) {
                    user.inventory.forEach(i => {
                        weight += (i.weight || 0.1) * i.quantity;
                        list.innerHTML += `<div class="bg-black/30 p-2 rounded-lg border border-white/5 flex justify-between"><span>${i.item_name}</span><span class="text-blue-400 font-bold">x${i.quantity}</span></div>`;
                    });
                } else {
                    list.innerHTML = '<div class="col-span-2 text-center py-4 opacity-20 italic">No cargo</div>';
                }
                document.getElementById('weight-info').innerText = `${weight.toFixed(1)}/100.0 KG`;
                document.getElementById('status').innerText = "‚óè System Linked";
                document.getElementById('status').classList.replace("text-red-500", "text-green-500");
            }
        }

        async function handleAction(type) {
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            addLog(`Initiating ${type}...`, "gray");
            
            const res = await apiCall(type);
            if (res) {
                addLog(res.msg, res.success ? "blue" : "red");
                if (res.success) sync();
            }
        }

        // –ü–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—É—Å–∫
        sync();
        // –ê–≤—Ç–æ-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–∑ –≤ 20 —Å–µ–∫
        setInterval(sync, 20000);
    </script>
</body>
</html>
